name: Shell Script Code Scan with shellharden

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  shell_scan:
    runs-on: ubuntu-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v4.1.1

    - name: Install Rust
      uses: actions-rs/toolchain@v2
      with:
        toolchain: stable
        components: cargo

    - name: Build shellharden from source
      run: |
        cargo install shellharden
        mkdir -p ~/.local/bin
        mv ~/.cargo/bin/shellharden ~/.local/bin/
        echo "$PATH"
        shellharden --version

    - name: Run shellharden
      run: |
        mkdir -p output
        find . -name "*.sh" -print0 | xargs -0 ~/.local/bin/shellharden --check > output/shellharden_results.txt || true

    - name: Upload shellharden Results
      uses: actions/upload-artifact@v4.3.1
      with:
        name: shellharden-results
        path: output/shellharden_results.txt
        retention-days: 5
